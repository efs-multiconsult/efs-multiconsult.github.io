<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>SceneLayer filter and query | Sample | ArcGIS API for JavaScript 4.18</title>
    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }

      #optionsDiv {
        width: 250px;
        padding: 0 12px 0 12px;
        background-color: white;
        padding: 10px;
      }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.18/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.18/"></script>

    <script>
      require(["esri/identity/OAuthInfo", "esri/portal/Portal", "esri/config", "esri/portal/PortalQueryParams", "esri/identity/IdentityManager", "esri/WebScene", "esri/views/SceneView", "esri/widgets/Legend", "esri/widgets/LayerList"], function(
      	OAuthInfo,
      	Portal,
      	esriConfig,
      	PortalQueryParams,
      	esriId,
        WebScene,
        SceneView,
        Legend,
        LayerList
      ) {


      	var info = new OAuthInfo({
			// Swap this ID out with registered application ID
			appId: "uexIzIm27zMWY9XL",
			// Uncomment the next line and update if using your own portal
			portalUrl: "https://cloudgis.multiconsult.no/portal/",
			// Uncomment the next line to prevent the user's signed in state from being shared with other apps on the same domain with the same authNamespace value.
			// authNamespace: "portal_oauth_inline",
			popup: false
		});

		esriId.registerOAuthInfos([info]);


		esriId
			.checkSignInStatus(info.portalUrl + "/sharing")
			.then(function() {
			displayItems();
			})
			.catch(console.error("catch..............."));



		esriId.getCredential(info.portalUrl + "/sharing");


		

        // load web scene from ArcGIS Online
        var webScene = new WebScene({
			portalItem: {
			// autocasts as new PortalItem()
			//id: "7685f7ba6b47426ea20d6f640cf98596"
			id: "992014ee27c74f45a3ce5fa616453d6e"
			}
        });

		// create the scene view
		var view = new SceneView({
			container: "viewDiv",
			map: webScene,
			environment: {
			lighting: {
				directShadowsEnabled: true
			}
			}
		});






		webScene.when(function() {
			// the field containing the building is different for each layer
			// buildingQuery defines the query corresponding to each layer in the web scene


			// we will use the Interior Space layer many times, so we'll save it in a variable
			var officeLayer = webScene.layers.find(function(l) {
			return l.title === "Interior Space";
			});


			
			/*
			// function that will filter by the selected floor
			function showFloors(event) {
			// retrieve the query stored in the selected value
			var floorQuery = event.target.value;

			// update the definition expression of all layers except the wireframe layer
			webScene.layers.forEach(function(layer) {
				if (layer.title !== "Building Wireframe") {
				layer.definitionExpression = floorQuery;
				}
			});
			}






			document.getElementById("floorSelect").addEventListener("change", showFloors);

			// add a legend for the officeLayer
			var legend = new Legend({
				view: view,
				layerInfos: [
					{
					layer: officeLayer,
					title: " "
					}
				]
			});

			view.ui.add(legend, "bottom-right");

			*/

			// Add a layer list to enable and disable the building wireframe
			var layerList = new LayerList({
				view: view
			});

			view.ui.add(layerList, {
				position: "top-right"
			});
        });

        

        view.ui.add(document.getElementById("optionsDiv"), {
          position: "top-left",
          index: 0
        });
      });
    </script>
  </head>

  <body>
    <div id="viewDiv"></div>
    <div id="optionsDiv" class="esri-widget">
      <div>
        <b>Filter building by floor:</b>
        <select id="floorSelect">
          <option value="1=1">All</option>
          <option value="FLOOR = '1'">1</option>
          <option value="FLOOR = '2'">2</option>
          <option value="FLOOR = '3'">3</option>
        </select>
      </div>
    </div>
  </body>
</html>
